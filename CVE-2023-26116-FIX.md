# CVE-2023-26116 Security Fix Documentation

## Vulnerability Summary

**CVE ID:** CVE-2023-26116
**Severity:** Medium (ReDoS)
**Affected Component:** `angular.copy()`
**Vulnerability Type:** Regular Expression Denial of Service (ReDoS)

### Description

`angular.copy()` can be abused with carefully crafted large/complex inputs, triggering catastrophic work during deep cloning. This can cause the browser to become unresponsive (Denial of Service). See Snyk advisory `SNYK-JS-ANGULAR-3373044` for details.
Reference: https://security.snyk.io/vuln/SNYK-JS-ANGULAR-3373044

## Vulnerability Analysis

`angular.copy()` performs a deep clone of objects by default. For very deep or adversarially structured inputs, the work can grow large. Additionally, the historical RegExp cloning path extracted flags using `toString().match(...)`, introducing unnecessary regex parsing on potentially large strings.

### Attack Vectors
1. Large, deeply nested objects (accidental or malicious) copied without a depth limit.
2. Stored DoS: adversarial JSON persisted on the server and copied on render in the client.

## Fix Implementation

**Commits:**
**Date:** November 13, 2025
**Author:** Fred Stark

### Changes Made

1. Introduce a conservative default depth cap for `angular.copy`:
   - If `maxDepth` is not provided, use a default budget (50).
   - This prevents excessive work on pathological inputs while preserving behavior for normal data.

2. Harden RegExp cloning path:
   - Build flags using native properties (`.flags` when available, otherwise via booleans: `global`, `ignoreCase`, `multiline`, `unicode`, `sticky`).
   - Avoids parsing `RegExp#toString()` with a secondary regex.

3. ngRoute shallow param update (defense-in-depth):
   - Replace deep copy of `$routeParams` with a shallow, in-place update that maintains object identity and removes stale keys.
   - Eliminates deep-copy on attacker-influenced URL parameters.

## Files Modified

1. `src/Angular.js`
   - Default depth budget for `copy()` when `maxDepth` is not provided.
   - Safe RegExp cloning without regex parsing on `.toString()`.

2. `src/ngRoute/route.js`
   - Use a local `replaceObject(dst, src)` helper + `shallowCopy()` to update `$routeParams` instead of deep `angular.copy`.

## Tests

Added regression tests to validate mitigations:

- `test/AngularSpec.js`
  - Caps deep copy by default and returns `'...'` beyond depth budget.
  - Preserves RegExp source, flags, and `lastIndex`.

## Why This Fixes/Mitigates the CVE

- A default depth budget prevents `angular.copy()` from performing unbounded work on adversarial nested inputs.
- Safe RegExp cloning keeps behavior while avoiding unnecessary regex parsing.
- Shallow `$routeParams` updates remove a deep-copy path over user-controlled URL parameters.

## Compatibility Notes

- The default depth budget is intentionally conservative (50) to avoid impacting typical application objects. In rare cases that require deeper structures, explicit `maxDepth` can be passed to `angular.copy()`.
- `$routeParams` semantics remain consistent (identity preserved, stale keys removed).

## References

- Snyk: Regular Expression Denial of Service (ReDoS) in AngularJS `angular.copy()`
  https://security.snyk.io/vuln/SNYK-JS-ANGULAR-3373044

## Status

✅ FIXED/MITIGATED — The fork enforces a default depth cap, hardens RegExp cloning, and removes deep-copy of `$routeParams`, mitigating the known ReDoS vectors in `angular.copy()` and ngRoute usage.


